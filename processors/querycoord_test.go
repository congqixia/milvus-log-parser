package processors

import (
	"encoding/json"
	"testing"
)

func TestParseLoad(t *testing.T) {
	val := `[{"base":{"msg_type":252,"msgID":429206213382373563,"timestamp":429206900841906177,"sourceID":1},"dst_nodeID":7,"infos":[{"segmentID":429206898403966977,"partitionID":429206895585918978,"collectionID":429206895585918977,"binlog_paths":[{"fieldID":100,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206898403966977/100/429206899059326977"]},{"fieldID":101,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206898403966977/101/429206899059326978"]},{"fieldID":102,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206898403966977/102/429206899059326979"]},{"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206898403966977/0/429206899059326980"]},{"fieldID":1,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206898403966977/1/429206899059326981"]}],"num_of_rows":1,"statslogs":[{"fieldID":1,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206898403966977/1/429206899059326981"]},{"fieldID":100,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206898403966977/100/429206899059326977"]},{"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206898403966977/0/429206899059326980"]}]}],"schema":{"name":"compact_XLmAnuVd","fields":[{"fieldID":100,"name":"int64","is_primary_key":true,"data_type":5},{"fieldID":101,"name":"float","data_type":10},{"fieldID":102,"name":"float_vector","data_type":101,"type_params":[{"key":"dim","value":"128"}]}]},"load_condition":2,"collectionID":429206895585918977},{"base":{"msg_type":252,"msgID":429206213382373563,"timestamp":429206900841906177,"sourceID":1},"dst_nodeID":7,"infos":[{"segmentID":429206896464101377,"partitionID":429206895585918978,"collectionID":429206895585918977,"binlog_paths":[{"fieldID":101,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206896464101377/101/429206897119461378"]},{"fieldID":102,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206896464101377/102/429206897119461379"]},{"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206896464101377/0/429206897119461380"]},{"fieldID":1,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206896464101377/1/429206897119461381"]},{"fieldID":100,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206896464101377/100/429206897119461377"]}],"num_of_rows":1,"statslogs":[{"fieldID":100,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206896464101377/100/429206897119461377"]},{"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206896464101377/0/429206897119461380"]},{"fieldID":1,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206896464101377/1/429206897119461381"]}]}],"schema":{"name":"compact_XLmAnuVd","fields":[{"fieldID":100,"name":"int64","is_primary_key":true,"data_type":5},{"fieldID":101,"name":"float","data_type":10},{"fieldID":102,"name":"float_vector","data_type":101,"type_params":[{"key":"dim","value":"128"}]}]},"load_condition":2,"collectionID":429206895585918977},{"base":{"msg_type":252,"msgID":429206213382373563,"timestamp":429206900841906177,"sourceID":1},"dst_nodeID":7,"infos":[{"segmentID":429206899229720577,"partitionID":429206895585918978,"collectionID":429206895585918977,"binlog_paths":[{"fieldID":100,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206899229720577/100/429206899898187777"]},{"fieldID":101,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206899229720577/101/429206899898187778"]},{"fieldID":102,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206899229720577/102/429206899898187779"]},{"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206899229720577/0/429206899898187780"]},{"fieldID":1,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206899229720577/1/429206899898187781"]}],"num_of_rows":1,"statslogs":[{"fieldID":100,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206899229720577/100/429206899898187777"]},{"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206899229720577/0/429206899898187780"]},{"fieldID":1,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206899229720577/1/429206899898187781"]}]}],"schema":{"name":"compact_XLmAnuVd","fields":[{"fieldID":100,"name":"int64","is_primary_key":true,"data_type":5},{"fieldID":101,"name":"float","data_type":10},{"fieldID":102,"name":"float_vector","data_type":101,"type_params":[{"key":"dim","value":"128"}]}]},"load_condition":2,"collectionID":429206895585918977},{"base":{"msg_type":252,"msgID":429206213382373563,"timestamp":429206900841906177,"sourceID":1},"dst_nodeID":7,"infos":[{"segmentID":429206895638347777,"partitionID":429206895585918978,"collectionID":429206895585918977,"binlog_paths":[{"fieldID":1,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206895638347777/1/429206896280600581"]},{"fieldID":100,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206895638347777/100/429206896280600577"]},{"fieldID":101,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206895638347777/101/429206896280600578"]},{"fieldID":102,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206895638347777/102/429206896280600579"]},{"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206895638347777/0/429206896280600580"]}],"num_of_rows":1,"statslogs":[{"fieldID":100,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206895638347777/100/429206896280600577"]},{"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206895638347777/0/429206896280600580"]},{"fieldID":1,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206895638347777/1/429206896280600581"]}]}],"schema":{"name":"compact_XLmAnuVd","fields":[{"fieldID":100,"name":"int64","is_primary_key":true,"data_type":5},{"fieldID":101,"name":"float","data_type":10},{"fieldID":102,"name":"float_vector","data_type":101,"type_params":[{"key":"dim","value":"128"}]}]},"load_condition":2,"collectionID":429206895585918977},{"base":{"msg_type":252,"msgID":429206213382373563,"timestamp":429206900841906177,"sourceID":1},"dst_nodeID":7,"infos":[{"segmentID":429206897567465473,"partitionID":429206895585918978,"collectionID":429206895585918977,"binlog_paths":[{"fieldID":101,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206897567465473/101/429206898220466178"]},{"fieldID":102,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206897567465473/102/429206898220466179"]},{"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206897567465473/0/429206898220466180"]},{"fieldID":1,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206897567465473/1/429206898220466181"]},{"fieldID":100,"binlogs":["files/insert_log/429206895585918977/429206895585918978/429206897567465473/100/429206898220466177"]}],"num_of_rows":1,"statslogs":[{"fieldID":100,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206897567465473/100/429206898220466177"]},{"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206897567465473/0/429206898220466180"]},{"fieldID":1,"binlogs":["files/stats_log/429206895585918977/429206895585918978/429206897567465473/1/429206898220466181"]}]}],"schema":{"name":"compact_XLmAnuVd","fields":[{"fieldID":100,"name":"int64","is_primary_key":true,"data_type":5},{"fieldID":101,"name":"float","data_type":10},{"fieldID":102,"name":"float_vector","data_type":101,"type_params":[{"key":"dim","value":"128"}]}]},"load_condition":2,"collectionID":429206895585918977}]`
	var reqs []LoadSegmentsRequest
	err := json.Unmarshal([]byte(val), &reqs)
	t.Log(err)
}
